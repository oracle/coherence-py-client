

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caches &mdash; Python Client for Oracle Coherence. v2.0.0 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=51b770b3"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Basics" href="basics.html" />
    <link rel="prev" title="Sessions" href="sessions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Python Client for Oracle Coherence. v2.0.0
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sessions.html">Sessions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="#near-caches">Near Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">The Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html">Querying</a></li>
<li class="toctree-l1"><a class="reference internal" href="aggregation.html">Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="entryprocessing.html">Entry Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="serialization.html">Serialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">Python Client API Reference for Oracle Coherence</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python Client for Oracle Coherence. v2.0.0</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Caches</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/caches.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="caches">
<h1>Caches<a class="headerlink" href="#caches" title="Link to this heading"></a></h1>
<p>Once a Session has been obtained, it is now possible to begin working with
<cite>NamedMap</cite> and/or <cite>NamedCache</cite> instances.  This is done by calling either
<cite>Session.get_map(name: str, cache_options: Optional[CacheOptions] = None)</cite> or
<cite>Session.get_cache(name: str, cache_options: Optional[CacheOptions] = None)</cite>.
The <cite>name</cite> argument is the logical name for this cache.  The optional <cite>cache_options</cite>
argument accepts a <cite>CacheOptions</cite> to configure the default time-to-live (ttl)
for entries placed in the cache as well as allowing the configuration of near
caching (discussed later in this section).</p>
<p>Here are some examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># obtain NamedCache &#39;person&#39;</span>
<span class="n">cache</span><span class="p">:</span> <span class="n">NamedCache</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get_cache</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># obtain NamedCache &#39;person&#39; with a default ttl of 2000 millis</span>
<span class="c1"># any entry inserted into this cache, unless overridden by a put call</span>
<span class="c1"># with a custom ttl, will have a default ttl of 2000</span>
<span class="n">options</span><span class="p">:</span> <span class="n">CacheOptions</span> <span class="o">=</span> <span class="n">CacheOptions</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">cache</span><span class="p">:</span> <span class="n">NamedCache</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get_cache</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="near-caches">
<h1>Near Caches<a class="headerlink" href="#near-caches" title="Link to this heading"></a></h1>
<p>Near caches are a local cache within the <cite>NamedMap</cite> or <cite>NamedCache</cite>
that will store entries as they are obtained from the remote cache.  By doing
so, it is possible to reduce the number of remote calls made to the Coherence
cluster by returning the locally cached value.  This local cache also
ensures updates made to, or removal of, an entry are properly
reflected thus ensuring stale data isn’t mistakenly returned.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Near caching will only work with Coherence CE <cite>24.09</cite> or later.  Attempting
to use near caching features with older versions will have no effect.</p>
</div>
<p>A near cache is configured via <cite>NearCacheOptions</cite> which provides several
options for controlling how entries will be cached locally.</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>ttl</cite> - configures the time-to-live of locally cached entries (this has no
impact on entries stored within Coherence).  If not specified, or the
<cite>ttl</cite> is <cite>0</cite>, entries in the near cache will not expire</p></li>
<li><dl class="simple">
<dt><cite>high_units</cite> - configures the max number of entries that may be locally</dt><dd><p>cached.  Once the number of locally cached entries exceeds the configured
value, the cache will be pruned down (least recently used entries first)
to a target size based on the configured <cite>prune_factor</cite>
(defaults to <cite>0.80</cite> meaning the prune operation would retain 80% of
the entries)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>high_units_memory</cite> - configures the maximum memory size, in bytes, the</dt><dd><p>locally cached entries may use.  If total memory exceeds the configured
value, the cache will be pruned down (least recently used entries first)
to a target size based on the configured <cite>prune_factor</cite> (defaults to
<cite>0.80</cite> meaning the prune operation would retain 80% the cache memory)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>prune_factor</cite> - configures the target near cache size after exceeding</dt><dd><p>either <cite>high_units</cite> or <cite>high_units_memory</cite> high-water marks</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>high_units</cite> and <cite>high_units_memory</cite> are mutually exclusive</p>
</div>
<p>Examples of configuring near caching:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># obtain NamedCache &#39;person&#39; and configure near caching with a local</span>
<span class="c1"># ttl of 20_000 millis</span>
<span class="n">near_options</span><span class="p">:</span> <span class="n">NearCacheOptions</span> <span class="o">=</span> <span class="n">NearCacheOptions</span><span class="p">(</span><span class="mi">20_000</span><span class="p">)</span>
<span class="n">cache_options</span><span class="p">:</span> <span class="n">CacheOptions</span> <span class="o">=</span> <span class="n">CacheOptions</span><span class="p">(</span><span class="n">near_cache_options</span><span class="o">=</span><span class="n">near_options</span><span class="p">)</span>
<span class="n">cache</span><span class="p">:</span> <span class="n">NamedCache</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get_cache</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># obtain NamedCache &#39;person&#39; and configure near caching with a max</span>
<span class="c1"># number of entries of 1_000 and when pruned, it will be reduced</span>
<span class="c1"># to 20%</span>
<span class="n">near_options</span><span class="p">:</span> <span class="n">NearCacheOptions</span> <span class="o">=</span> <span class="n">NearCacheOptions</span><span class="p">(</span><span class="n">high_units</span><span class="o">=</span><span class="mi">1_000</span><span class="p">,</span> <span class="n">prune_factor</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>
<span class="n">cache_options</span><span class="p">:</span> <span class="n">CacheOptions</span> <span class="o">=</span> <span class="n">CacheOptions</span><span class="p">(</span><span class="n">near_cache_options</span><span class="o">=</span><span class="n">near_options</span><span class="p">)</span>
<span class="n">cache</span><span class="p">:</span> <span class="n">NamedCache</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get_cache</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<p>To verify the effectiveness of a near cache, several statistics are monitored
and may be obtained from the <cite>CacheStats</cite> instance returned by the
<cite>near_cache_stats</cite> property of the <cite>NamedMap</cite> or <cite>NamedCache</cite></p>
<p>The following statistics are available (the statistic name given is the same
property name on the <cite>CacheStats</cite> instance)</p>
<blockquote>
<div><ul class="simple">
<li><p>hits - the number of times an entry was found in the near cache</p></li>
<li><p>misses - the number of times an entry was not found in the near cache</p></li>
<li><p>misses_duration - The accumulated time, in millis, spent for a cache miss
(i.e., having to make a remote call and update the local cache)</p></li>
<li><p>hit_rate - the ratio of hits to misses</p></li>
<li><p>puts - the total number of puts that have been made against the near cache</p></li>
<li><p>gets - the total number of gets that have been made against the near cache</p></li>
<li><p>prunes - the number of times the cache was pruned due to exceeding the
configured <cite>high_units</cite> or <cite>high_units_memory</cite> high-water marks</p></li>
<li><p>expires - the number of times the near cache’s expiry logic expired entries</p></li>
<li><p>num_pruned - the total number of entries that were removed due to exceeding the
configured <cite>high_units</cite> or <cite>high_units_memory</cite> high-water marks</p></li>
<li><p>num_expired - the total number of entries that were removed due to
expiration</p></li>
<li><p>prunes_duration - the accumulated time, in millis, spent pruning
the near cache</p></li>
<li><p>expires_duration - the accumulated time, in millis, removing
expired entries from the near cache</p></li>
<li><p>size - the total number of entries currently held by the near cache</p></li>
<li><p>bytes - the total bytes the near cache entries consume</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>near_cache_stats</cite> option will return <cite>None</cite> if near caching isn’t
configured or available</p>
</div>
<p>The following example demonstrates the value that near caching can provide:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Copyright (c) 2024, Oracle and/or its affiliates.</span>
<span class="linenos"> 2</span><span class="c1"># Licensed under the Universal Permissive License v 1.0 as shown at</span>
<span class="linenos"> 3</span><span class="c1"># https://oss.oracle.com/licenses/upl.</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="linenos"> 6</span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="linenos"> 7</span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">reduce</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">from</span><span class="w"> </span><span class="nn">coherence</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheOptions</span><span class="p">,</span> <span class="n">CacheStats</span><span class="p">,</span> <span class="n">NamedCache</span><span class="p">,</span> <span class="n">NearCacheOptions</span><span class="p">,</span> <span class="n">Session</span>
<span class="linenos">10</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">do_run</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">13</span>    <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Session</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="c1"># obtain the basic cache and configure near caching with</span>
<span class="linenos">16</span>    <span class="c1"># all defaults; meaning no expiry or pruning</span>
<span class="linenos">17</span>    <span class="n">cache_remote</span><span class="p">:</span> <span class="n">NamedCache</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get_cache</span><span class="p">(</span><span class="s2">&quot;remote&quot;</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="n">cache_near</span><span class="p">:</span> <span class="n">NamedCache</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get_cache</span><span class="p">(</span>
<span class="linenos">19</span>        <span class="s2">&quot;near&quot;</span><span class="p">,</span> <span class="n">CacheOptions</span><span class="p">(</span><span class="n">near_cache_options</span><span class="o">=</span><span class="n">NearCacheOptions</span><span class="p">(</span><span class="n">ttl</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="linenos">20</span>    <span class="p">)</span>
<span class="linenos">21</span>
<span class="linenos">22</span>    <span class="k">await</span> <span class="n">cache_remote</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="linenos">23</span>    <span class="k">await</span> <span class="n">cache_near</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="linenos">24</span>    <span class="n">stats</span><span class="p">:</span> <span class="n">CacheStats</span> <span class="o">=</span> <span class="n">cache_near</span><span class="o">.</span><span class="n">near_cache_stats</span>
<span class="linenos">25</span>
<span class="linenos">26</span>    <span class="c1"># these knobs control:</span>
<span class="linenos">27</span>    <span class="c1">#  - how many current tasks to run</span>
<span class="linenos">28</span>    <span class="c1">#  - how many entries will be inserted and queried</span>
<span class="linenos">29</span>    <span class="c1">#  - how many times the calls will be invoked</span>
<span class="linenos">30</span>    <span class="n">task_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span>
<span class="linenos">31</span>    <span class="n">num_entries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1_000</span>
<span class="linenos">32</span>    <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>
<span class="linenos">33</span>
<span class="linenos">34</span>    <span class="c1"># seed data to populate the cache</span>
<span class="linenos">35</span>    <span class="n">cache_seed</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_entries</span><span class="p">)}</span>
<span class="linenos">36</span>    <span class="n">cache_seed_keys</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cache_seed</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="linenos">37</span>    <span class="nb">print</span><span class="p">()</span>
<span class="linenos">38</span>
<span class="linenos">39</span>    <span class="c1"># task calling get_all() for 1_000 keys</span>
<span class="linenos">40</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_task</span><span class="p">(</span><span class="n">task_cache</span><span class="p">:</span> <span class="n">NamedCache</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">41</span>        <span class="n">begin</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
<span class="linenos">42</span>
<span class="linenos">43</span>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
<span class="linenos">44</span>            <span class="k">async</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="k">await</span> <span class="n">task_cache</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">cache_seed_keys</span><span class="p">):</span>
<span class="linenos">45</span>                <span class="k">continue</span>
<span class="linenos">46</span>
<span class="linenos">47</span>        <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span> <span class="o">-</span> <span class="n">begin</span><span class="p">)</span> <span class="o">//</span> <span class="mi">1_000_000</span>
<span class="linenos">48</span>
<span class="linenos">49</span>    <span class="k">await</span> <span class="n">cache_remote</span><span class="o">.</span><span class="n">put_all</span><span class="p">(</span><span class="n">cache_seed</span><span class="p">)</span>
<span class="linenos">50</span>    <span class="k">await</span> <span class="n">cache_near</span><span class="o">.</span><span class="n">put_all</span><span class="p">(</span><span class="n">cache_seed</span><span class="p">)</span>
<span class="linenos">51</span>
<span class="linenos">52</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Run without near caching ...&quot;</span><span class="p">)</span>
<span class="linenos">53</span>    <span class="n">begin_outer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
<span class="linenos">54</span>    <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">get_all_task</span><span class="p">(</span><span class="n">cache_remote</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">task_count</span><span class="p">)])</span>
<span class="linenos">55</span>    <span class="n">end_outer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
<span class="linenos">56</span>    <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_outer</span> <span class="o">-</span> <span class="n">begin_outer</span>
<span class="linenos">57</span>    <span class="n">task_time</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">:</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
<span class="linenos">58</span>
<span class="linenos">59</span>    <span class="c1"># Example output</span>
<span class="linenos">60</span>    <span class="c1"># Run without near caching ...</span>
<span class="linenos">61</span>    <span class="c1"># [remote] 25 tasks completed!</span>
<span class="linenos">62</span>    <span class="c1"># [remote] Total time: 4246ms</span>
<span class="linenos">63</span>    <span class="c1"># [remote] Tasks completion average: 3755.6</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[remote] </span><span class="si">{</span><span class="n">task_count</span><span class="si">}</span><span class="s2"> tasks completed!&quot;</span><span class="p">)</span>
<span class="linenos">66</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[remote] Total time: </span><span class="si">{</span><span class="n">total_time</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">1_000_000</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
<span class="linenos">67</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[remote] Tasks completion average: </span><span class="si">{</span><span class="n">task_time</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">task_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">68</span>
<span class="linenos">69</span>    <span class="nb">print</span><span class="p">()</span>
<span class="linenos">70</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Run with near caching ...&quot;</span><span class="p">)</span>
<span class="linenos">71</span>    <span class="n">begin_outer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
<span class="linenos">72</span>    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">get_all_task</span><span class="p">(</span><span class="n">cache_near</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">task_count</span><span class="p">)])</span>
<span class="linenos">73</span>    <span class="n">end_outer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
<span class="linenos">74</span>    <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_outer</span> <span class="o">-</span> <span class="n">begin_outer</span>
<span class="linenos">75</span>    <span class="n">task_time</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">:</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
<span class="linenos">76</span>
<span class="linenos">77</span>    <span class="c1"># Run with near caching ...</span>
<span class="linenos">78</span>    <span class="c1"># [near] 25 tasks completed!</span>
<span class="linenos">79</span>    <span class="c1"># [near] Total time: 122ms</span>
<span class="linenos">80</span>    <span class="c1"># [near] Tasks completion average: 113.96</span>
<span class="linenos">81</span>    <span class="c1"># [near] Near cache statistics: CacheStats(puts=1000, gets=100000, hits=99000,</span>
<span class="linenos">82</span>    <span class="c1">#     misses=1000, misses-duration=73ms, hit-rate=0.99, prunes=0,</span>
<span class="linenos">83</span>    <span class="c1">#     num-pruned=0, prunes-duration=0ms, size=1000, expires=0,</span>
<span class="linenos">84</span>    <span class="c1">#     num-expired=0, expires-duration=0ms, memory-bytes=681464)</span>
<span class="linenos">85</span>
<span class="linenos">86</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[near] </span><span class="si">{</span><span class="n">task_count</span><span class="si">}</span><span class="s2"> tasks completed!&quot;</span><span class="p">)</span>
<span class="linenos">87</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[near] Total time: </span><span class="si">{</span><span class="n">total_time</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">1_000_000</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
<span class="linenos">88</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[near] Tasks completion average: </span><span class="si">{</span><span class="n">task_time</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">task_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">89</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[near] Near cache statistics: </span><span class="si">{</span><span class="n">stats</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">90</span>
<span class="linenos">91</span>    <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos">92</span>
<span class="linenos">93</span>
<span class="linenos">94</span><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">do_run</span><span class="p">())</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sessions.html" class="btn btn-neutral float-left" title="Sessions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="basics.html" class="btn btn-neutral float-right" title="The Basics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright (c) 2022, 2025, Oracle and/or its affiliates..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>